import fetch from 'node-fetch';

const handler = async (message, { conn, usedPrefix, __dirname, text, isPrems }) => {
  if (usedPrefix === 'a' || usedPrefix === 'A') return;

  try {
    const now = new Date(new Date() + 3600000);

    const weekdayOptions = { weekday: "long" };
    const dayName = now.toLocaleDateString('ar', weekdayOptions);

    const dateOptions = { day: "numeric", month: "long", year: "numeric" };
    const fullDate = now.toLocaleDateString('ar', dateOptions);

    const uptimeMs = process.uptime() * 1000;
    const uptimeStr = clockString(uptimeMs);

    const user = global.db.data.users[message.sender];
    const { money, joincount, exp, limit, level, role } = user;

    const totalUsers = Object.entries(global.db.data.users).length || '0';

    const menuText = `
> *Ë¼ðŸ“Ë¹ Ù…Ù€Ù€Ø¹Ù€Ù„Ù€ÙˆÙ…Ù€Ø§Øª Ø§Ù„Ù€Ù€Ù…Ù€Ø³Ù€ØªÙ€Ù€Ø®Ù€Ù€Ø¯Ù… â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž Ù…Ù€Ø±Ø­Ù€Ø¨Ù€Ù€Ø§ " @${message.sender.split('@')[0]} "*
*â”†â†ž ÙˆÙ‚Ù€Øª Ø§Ù„Ù€Ø¹Ù€Ù…Ù€Ù„ ${uptimeStr}*
*â”†â†ž Ø§Ù„Ù€ØªÙ€Ù€Ø§Ø±ÙŠÙ€Ù€Ø® ${dayName} ${fullDate}*
*â”†â†ž Ø§Ù„Ù…Ø³Ø®Ø¯Ù…ÙŠÙ† ${totalUsers}*
*â”†â†ž Ù„Ù€Ø§ØªÙ€Ù†Ù€Ø³Ù€Ù€ÛŒ Ù‚Ù€Ø¨Ù€Ù€Ù„ ÙƒÙ€Ù€Ù„ Ø§Ù…Ù€Ù€Ø± ï¹™.ï¹š*
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
> *Ë¼ðŸ“Ë¹â†œ Ù‚Ù€Ù€Ø³Ù€Ù€Ù… Ø§Ù„Ù€Ø§Ø¹Ù€Ø¶Ù€Ø§Ø¡ â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž Ù…Ù†Ø´Ù†*
*â”†â†ž Ù…Ø®ÙÙŠ*
*â”†â†ž Ø§Ù„Ø¬Ø±ÙˆØ¨*
*â”†â†ž Ø§Ù„Ø§Ø´Ø¨Ø§Ø­*
*â”†â†ž Ø±ÙØ¹*
*â”†â†ž Ø®ÙØ¶*
*â”†â†ž Ø­Ø°Ù*
*â”†â†ž Ø·Ø±Ø¯*
*â”†â†ž ØªØ­ÙƒÙ…* 
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
> *Ë¼ðŸ“Ë¹â†œ Ù‚Ù€Ù€Ø³Ù€Ù€Ù… Ø§Ù„Ù€Ø¯ÙŠÙ€Ù€Ù† â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž Ø§Ø°ÙƒØ§Ø±_Ø§Ù„ØµØ¨Ø§Ø­*
*â”†â†ž Ø§Ø°ÙƒÙ€Ø§Ø± Ø§Ù„Ù€Ù…Ø³Ø§Ø¡*
*â”†â†ž Ø§ÙŠÙ‡*
*â”†â†ž Ø³ÙˆØ±Ù‡* 
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
> *Ë¼ðŸ“Ë¹â†œ Ù‚Ù€Ù€Ø³Ù€Ù€Ù… Ø§Ù„ØªÙ€Ø­Ù€ÙˆÙŠÙ€Ù€Ù„ â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž Ù…Ù„ØµÙ‚*
*â”†â†ž Ø³Ø±Ù‚Ù‡*
*â”†â†ž Ù„ØµÙˆØ±Ù‡*
*â”†â†ž Ù„ÙÙŠØ¯ÙŠÙˆ*
*â”†â†ž Ù„ØµÙˆØª*
*â”†â†ž Ø¬ÙˆØ¯Ù‡*
*â”†â†ž Ø§Ù†Ø·Ù‚ÙŠ* 
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
> *Ë¼ðŸ“Ë¹â†œ Ù‚Ù€Ù€Ø³Ù€Ù€Ù… Ø§Ù„Ù€ØªÙ€Ø­Ù€Ù…Ù€ÙŠÙ€Ù„ â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž ØªÙŠÙƒ*
*â”†â†ž ØµÙˆØ±ØªÙŠÙƒ*
*â”†â†ž ÙŠÙˆØª*
*â”†â†ž ÙŠÙˆØª-Ù„Ù†Ùƒ*
*â”†â†ž Ø§Ù†Ø³ØªØ§*
*â”†â†ž ÙÙŠØ³*
*â”†â†ž Ø§ØºÙ†ÙŠÙ‡*
*â”†â†ž ØªØ·Ø¨ÙŠÙ‚*
*â”†â†ž Ø¨ÙŠÙ†*
*â”†â†ž Ø¨ÙŠÙ†_Ù„ÙŠÙ†Ùƒ* 
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
> *Ë¼ðŸ“Ë¹â†œ Ù‚Ù€Ù€Ø³Ù€Ù€Ù… Ø§Ù„Ù€Ø°Ú©Ù€Ù€Ø§Ø¡  â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž Ø´Ø§Ø¯Ùˆ*
*â”†â†ž ÙƒØ§Ø±Ø§*
*â”†â†ž Ø³ÙŠØ±ÙŠ*
*â”†â†ž Ø§Ø±Ø³Ù…* 
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
> *Ë¼ðŸ“Ë¹â†œ Ù‚Ù€Ù€Ø³Ù€Ù€Ù… Ø§Ù„Ù€ØªØ±ÙÙ€ÙŠÙ€Ù‡  â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž ÙƒØª*
*â”†â†ž Ù†Ø±Ø¯*
*â”†â†ž ØªØ­Ø¯ÙŠ*
*â”†â†ž Ø§Ù„Ø¹Ø¨*
*â”†â†ž Ø§ÙƒØ³ Ø§Ùˆ*
*â”†â†ž Ø±Ù‡Ø§Ù†*
*â”†â†ž Ù„Ùˆ*
*â”†â†ž ØªØ§Ø¬*
*â”†â†ž ÙØ²ÙˆØ±Ù‡*
*â”†â†ž ØµØ±Ø§Ø­Ù‡*
*â”†â†ž Ø­Ø±ÙˆÙ*
*â”†â†ž Ù†ØµÙŠØ­Ù‡* 
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
> *Ë¼ðŸ“Ë¹â†œ Ù‚Ø³Ù… Ø§Ù„ØµÙˆØ± Ùˆ Ø§Ù„Ø£ÙÙ„Ø§Ù… â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž Ø®Ù„ÙÙŠÙ‡*
*â”†â†ž Ù…ÙŠÙ…Ø²*
*â”†â†ž Ø·Ù‚Ù…*
*â”†â†ž Ø·Ù‚Ù…Ùˆ*
*â”†â†ž Ø·Ù‚Ù…ÙŠ*
*â”†â†ž Ù‚Ø·*
*â”†â†ž Ø§ÙŠØ¯Øª* 
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
> *Ë¼ðŸ“Ë¹â†œ Ù‚Ù€Ù€Ø³Ù€Ù€Ù… Ø§Ù„Ù€Ø£Ø¹Ù€Ø¶Ù€Ù€Ø§Ø¡ â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž Ù†Ø³Ø¨Ù‡*
*â”†â†ž Ø­Ø¨*
*â”†â†ž ÙˆØ§ØªØ³*
*â”†â†ž Ø´Ø®ØµÙŠÙ‡*
*â”†â†ž Ø²Ø®Ø±ÙÙ‡*
*â”†â†ž Ù‚Ù„Ø¨* 
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
> *Ë¼ðŸ“Ë¹â†œ Ù‚Ù€Ù€Ø³Ù€Ù€Ù… Ø§Ù„Ù€Ù…Ù€Ø·Ù€Ù€ÙˆØ± â†¶*
*â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
*â”†â†ž Ø­Ø¸Ø±*
*â”†â†ž Ø±ÙØ¹-Ø§Ù„Ø­Ø¸Ø±*
*â”†â†ž Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†*
*â”†â†ž Ø¨Ø§Ù†*
*â”†â†ž Ø±ÙØ¹-Ø¨Ø§Ù†*
*â”†â†ž Ø§Ù„Ù…Ø¨Ù†Ø¯ÙŠÙ†*
*â”†â†ž Ø§Ù†Ø¶Ù…*
*â”†â†ž Ø§Ø®Ø±Ø¬*
*â”†â†ž Ø§Ù„Ø¬Ø±ÙˆØ¨Ø§Øª* 
*â•¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŸ¢Ù€*
`.trim();

    const mentions = [
      message.sender,
      "201063720595@s.whatsapp.net"
    ];

    const contactMessage = {
      key: {
        participants: "0@s.whatsapp.net",
        remoteJid: "status@broadcast",
        fromMe: false,
        id: "Halo"
      },
      message: {
        contactMessage: {
          vcard: `BEGIN:VCARD
VERSION:3.0
N:Sy;Bot;;;
FN:y
item1.TEL;waid=${message.sender.split('@')[0]}:${message.sender.split('@')[0]}
item1.X-ABLabel:Ponsel
END:VCARD`
        }
      },
      participant: "0@s.whatsapp.net"
    };

    const image = { url: "https://files.catbox.moe/icnjcp.jpg" };

    await conn.sendMessage(
      message.chat,
      {
        image,
        caption: menuText,
        mentions
      },
      {
        quoted: message.isGroup ? message : contactMessage
      }
    );

  } catch (err) {
    console.error(err);
    conn.reply(message.chat, "*â— Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ Ø¨Ù„Øº Ø§Ù„Ù…Ø·ÙˆØ±.*", message);
  }
};

handler.command = /^(menu|Ø§ÙˆØ§Ù…Ø±|Ø§Ù„Ø§ÙˆØ§Ù…Ø±)$/i;
handler.exp = 50;
handler.fail = null;

export default handler;

function clockString(ms) {
  const h = isNaN(ms) ? '--' : Math.floor(ms / 3600000);
  const m = isNaN(ms) ? '--' : Math.floor(ms / 60000) % 60;
  const s = isNaN(ms) ? '--' : Math.floor(ms / 1000) % 60;
  return [h, m, s].map(v => v.toString().padStart(2, '0')).join(':');
}